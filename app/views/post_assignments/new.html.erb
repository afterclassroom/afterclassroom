<% content_for :you_are_here do -%>
  You are here: <a href="/">Home</a><%= link_to "Assignments", post_assignments_path, :class => "abLink-detail" %><%= link_to "Detail", "#", :class => "abLink-detail" %>
<% end -%>

<% content_for :post_button do -%>
  <%= render :partial => 'shared/post_button', :locals => {:new_post_path => @new_post_path} %>
<% end -%>

<% content_for :menu_sub do -%>
  <%= render :partial => "submenu" %>
<% end -%>

<!--Content-->
<div class="contDetL">
  <div class="contDetLin post">
    <div class="AsDTop">
      <h1 class="titleH1">Posting to the world!</h1>
    </div>
    <div class="postCont">
      <% form_for(@post_assignment, :html => {:multipart => true, :id => "form_post" }) do |f| %>
        <% fields_for @post_assignment.post do |post| %>
          <%= display_flash_messages %>
          <div class="postReq">*(asterisk) is required.</div>
          <div class="postItem">
            <div class="postTit">Title*</div>
            <div class="postInp"><%= post.text_field :title, :class => 'required', :style => "width:360px;" %></div>
          </div>
          <div class="postItem">
            <div class="postTit">Description*</div>
            <div class="postInput">
              <div class="postDesInf" id="post_description_counter"><span>0</span> characters (900 max)</div>
              <div class="postInp"><%= post.text_area :description, :class => 'required' %></div>
            </div>
          </div>
          <div class="postItem">
            <div class="postTit">School</div>
            <div class="postInp">Your are at <strong><%= School.find(@school).name %></strong> - <%= link_to("Click here", "/users_select_school/show?height=170", :class => "thickbox", :title => "Select Schoools") %> to choose another school.</div>
          </div>
          <div class="postItemDep">
            <div class="postTit">Department</div>
            <div class="postDep"><%= f.text_field :department_id %></div>
          </div>
          <div class="postItem">
            <div class="postTit">Email</div>
            <div class="postRad">
              <div><%= radio_button "post", "use_this_email", true, :checked => @post_assignment.post.use_this_email %> Use my login email instead</div>
              <div><%= radio_button "post", "use_this_email", false, :checked => !@post_assignment.post.use_this_email %> Reply to [post category] - xxxxxx@afterclassroom.com (AC anonymizes your ..)</div>
            </div>
          </div>
          <div class="postItem">
            <div class="postTit">Due date*</div>
            <div class="postInp"><%= text_field_tag "post_assignment[due_date]", @post_assignment.due_date != nil ? @post_assignment.due_date.strftime("%m/%d/%Y") : nil, :id => "post_assignment_due_date", :class => 'required date', :style => "width:100px" %></div>
          </div>
          <div class="postItem">
            <div class="postTit">Professor*</div>
            <div class="postInp"><%= f.text_field :professor, :class => 'required', :style => "width:208px" %></div>
          </div>
          <div class="postItem">
            <div class="postTit">Add/Edit File</div>
            <div id="divinputfile">
              <%= post.file_field :attach, :onchange => "$('#fakefilepc').val(this.value);", :size => "39", :class => "filepc" %>
              <div id="fakeinputfile"><input name="fakefilepc" type="text" id="fakefilepc" /></div>
            </div>
          </div>
          <div class="postItem">
            <div class="postTit">Tag</div>
            <div class="postInp"><%= text_field_tag "tag", "", :style => "width:280px" %></div>
          </div>
        </div>
        <div class="submit"><a href="javascript:;" onclick="submit();">Submit</a></div>
      <% end %>
    <% end %>
  </div>
</div>

<div class="contMainR">
  <!--Browser by Subject-->
  <%= render :partial => "shared/browser_by_subject", :locals => {:tags => @tags} %>
  <!--Browser by Subject-->

  <!--Ads-->
  <%= render :partial => "ads/show_vertical_ads" %>
  <!--Ads-->

  <!--Recent Request Assignments-->
  <%= render :partial => "recent_request_assignments" %>
  <!--Recent Request Assignments-->
</div>
<!--Content-->

<ul id="department_menu" class="mcdropdown_menu">
  <%
  departments = Department.of_school(@school)
%>
  <li rel_department="">
    Chose department
  </li>
  <%
  category_id = ""
%>
  <% departments.each do |dp| %>
    <% if category_id == "" %>
      <li rel="category_id_<%= dp.department_category.id %>">
        <%= dp.department_category.name %>
        <ul>
          <li rel_department="<%= dp.id %>"><%= dp.name %></li>
        <% elsif category_id == dp.department_category.id %>
          <li rel_department="<%= dp.id %>"><%= dp.name %></li>
        <% else %>
        </ul>
      </li>
      <li rel="category_id_<%= dp.department_category.id %>">
        <%= dp.department_category.name %>
        <ul>
          <li rel_department="<%= dp.id %>"><%= dp.name %></li>
        <% end %>
        <% category_id = dp.department_category.id %>
      <% end %>
    </ul>
  </li>
</ul>

<script type="text/javascript">
  $("#post_assignment_department_id").mcDropdown("#department_menu", {
    width: 350,
    valueAttr: "rel_department"
  });
  $("#post_description").counter({
    count: 'up',
    goal: 900
  });
  $(function() {
    $("#post_assignment_due_date").datepicker();
  });
  function submit(){
    var result = $("#form_post").validate();
    if (result) {
      $("#form_post").submit();
    }
  }
</script>