<%= juggernaut :debug => true, :client_id => current_user.login %>
<%= render :partial => "friends_changed_message", :locals => {:friends_change => @friends_change} %>
<div id="div_friends_want_you_chat">
</div>
<div id="div_friends_you_invited_to_chat">
</div>
<%= render :partial => "friends_in_chatting", :locals => {:friends_in_chat => @friends_in_chat} %>

<script>
	function invite_chat(login) {
		new Ajax.Request('/student_louge/invite_chat', 
		{asynchronous:true, 
		 evalScripts:true, 
		 method:'get',
		 onComplete:function(request){
			//
		 }, 
		 parameters: { user: login } 
		}); 
	}
	
	function add_users_to_chat(chanel_name){
	  obj_form = document.forms['form_' + chanel_name];
		len = obj_form.elements.length;
		val = "";
		var i=0;
		for(i=0; i<len ; i++) 
		{
			if(obj_form.elements[i].type == "checkbox" && obj_form.elements[i].checked) 
			{
				val += obj_form.elements[i].value + ";";
			}
		}   
		
		new Ajax.Request('/student_louge/add_users_to_chat', 
		{asynchronous:true, 
		 evalScripts:true, 
		 method:'get',
		 onComplete:function(request){
			//
		 }, 
		 parameters: { chanel_name: chanel_name, users_id: val } 
		});
	}
	
	function send_data(id, chanel_name) {
		new Ajax.Request('/student_louge/send_data', 
		{asynchronous:true, 
		 evalScripts:true, 
		 method:'get',
		 onComplete:function(request){
			$('chat_input_'+id).value = '';
		 }, 
		 parameters: {chanel_name: chanel_name, chat_input: $('chat_input_'+id).value } 
		}); 
	}
	
	function stop_chat(chanel_name){
		new Ajax.Request('/student_louge/stop_chat', 
			{asynchronous:true, 
			 evalScripts:true, 
			 method:'get',
			 onComplete:function(request){
				kill_mydow(chanel_name);
			 }, 
			 parameters: {chanel_name: chanel_name} 
			});
	}
	
	function friends_you_invited_chat(){
		new Ajax.Updater('div_friends_you_invited_to_chat', '/student_louge/friends_you_invited_chat', 
			{asynchronous:true, 
			 evalScripts:true, 
			 method:'get'}); 
	}
	
	function friends_want_you_chat(){
		new Ajax.Updater('div_friends_want_you_chat', '/student_louge/friends_want_you_chat',
			{asynchronous:true, 
			 evalScripts:true, 
			 method:'get'}); 
	}
	
	function scroll_div(id){
		$(id).scrollTop = $(id).scrollHeight
	}
</script>
<% if @user_invite_chat %>			
<script>
  window.onload(invite_chat('<%= @user_invite_chat.login %>'));
	friends_you_invited_chat();
	friends_want_you_chat();
</script>
<% end %>