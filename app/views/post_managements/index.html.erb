<input type="text" id="search_text" value="" name="searchPost"/>
<button type="button" id="idsearch">Search</button>

<div class="shopP2">
  <div class="tablePost">
    <table cellspacing="0" cellpadding="0" style="width: 100%;">
      <tbody><tr class="postHead">
          <th class="post1"><div class="date" id="date"><a href="#">Date</a></div></th>
          <th class="post3">
            <div>
              <select id="category" name="Select1">
                <option>Category</option>
                <%  @post_cat.each do |pc| %>
                  <option value="<%= pc.class_name %>"><%= pc.name %></option>
                <% end %>
              </select>
            </div>
          </th>
          <th class="post4"><div>Title</div></th>
          <th class="post5"><div>View</div></th>
          <th class="post6"><div>Promote Your Ad</div></th>
          <th class="post8"><div>Available Amount</div></th>
          <th class="post9"><div>Track your promotion expense</div></th>
          <th class="post10"><div>Status</div></th>
        </tr>
        <% if @all_posts.size > 0 %>
          <%  @all_posts.each do |p| %>
            <tr>
              <td><%= p.created_at.strftime("%d %b %y") %></td>
              <td class="postCate"><a href="#"><%= p.post_category.name %></a></td>
              <td class="postTitle">Sed tincidunt sem sollicitudin enim dapibus hendrerit.
                <div><a href="#">Click here to edit</a></div>
              </td>
              <td>100</td>
              <td class="postPro">Not promoted
                <div><a href="#">Click here to promote</a></div>
              </td>
              <td>$0</td>
              <td>Not available</td>
              <td>Running for 7 more days</td>
            </tr>
          <% end %>
        <% else %>
          No result found
        <% end %>

      </tbody></table>
  </div>

  <div class="assPage">
    <div class="curPage">

      <%= will_paginate @all_posts %>

    </div>
  </div>
</div>
<script type="text/javascript">
  $(document).ready(function(){

    var selected = 'Category';/*Default value*/
    var sortType = 'DESC';/*Default value*/

    $("select#category").change(function(){

      selected = $("select#category").children(":selected").val();

      console.log('value == '+selected);
      
      call_with_ajax('1',sortType,selected);

    });

    var currentSort = '<%= @sort %>';
    if (currentSort == 'DESC'){
      $('#date a').css("background-image", "url(/images/icon-Date.gif)");
    }
    else{
      $('#date a').css("background-image", "url(/images/icon-DateDesc.gif)");
    }

    $('#date').click(function(){
      var strImg = $('#date a').css("background-image");

      if ( strImg.indexOf('Desc', 0) > 0){
        //alert('goting to sort descending');
        $('#date a').css("background-image", "url(/images/icon-Date.gif)");
        sortType = 'DESC';
      }
      else{
        //alert('going to sort ascending');
        $('#date a').css("background-image", "url(/images/icon-DateDesc.gif)");
        sortType = 'ASC';
      }
      call_with_ajax('1',sortType,selected);
    });
    
    $('.curPage .current').each(function(){
      var page_href = $(this).attr('href');
      
      $(this).attr('href','#');
      
      $(this).click(function(){
        console.log('str =='+page_href);

        if (page_href != undefined){
          var arr = page_href.split('page=');
          console.log('len of arr == '+arr[1]);
        }

        var str_href = '/post_managements/with_type?category='+selected+'&sort='+sortType+'&page='+arr[1];
        console.log('sortType=='+sortType+' ||||| category=='+selected);

        call_with_ajax(arr[1],sortType,selected);

      });


    });
    $('.curPage .disabled').each(function(){
      var prev_next_href = $(this).attr('href');
      $(this).attr('href','#');

      if (prev_next_href!= undefined){
        $(this).click(function(){
          console.log('str =='+prev_next_href);
        });
      }

    });

  });
  function call_with_ajax(page,sort,category){

    var str_href = '/post_managements/with_type?category='+category+'&sort='+sort+'&page='+page;

    $.ajax({
      url: str_href,
      type: "GET",
      dataType: "html",
      failure: function(msg){
        alert('ajax fail:'+msg);
      },
      success: function(msg){
        $('.shopP2').html(msg);
      }
    });
  }
  /*BEGIN SEARCH*/
  $('#idsearch').click(function(){

    str_search = $('#search_text').val();

    var schr_href = '/post_managements/search_post?str_search='+str_search;

    $.ajax({
      url: schr_href,
      type: "GET",
      dataType: "html",
      failure: function(msg){
        alert('ajax fail:'+msg);
      },
      success: function(msg){
        $('.shopP2').html(msg);
      }
    });

  });
  /*END SEARCH*/
</script>