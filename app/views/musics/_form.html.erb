<%= form_tag "", {:id => "form_album", :name => "form_album", :multipart => true } do |f| %>
    <div class="photoEx">
      <div class="stoExItem">
        <div class="stoExItemL">Music album name*</div>
        <div class="stoExItemR"><%= text_field_tag "album_name", "" %></div>
      </div>
      <div class="stoExItem">
        <div class="stoExItemL">Music album image*</div>
        <div class="stoExItemR">
          <div id="fakeinputfile" style="margin-top:-8px"><input type="text" id="fakefilepc" name="fakefilepc" style="width:180px"/></div>
          <div id="divinputfile" style="width: 252px; margin-top: -24px; background: url(/images/upload_file.png) no-repeat scroll 60% 2px transparent; padding-left: 124px; padding-top: 5px;" id="divinputfile"></div>
        </div>
      </div>
      <div class="stoExBtm">
        <div class="stoExCre"><a href="javascript:;" onclick="create_album();">Create</a></div>
      </div>
    </div>
  <% end %>
  
  <script type="text/javascript">
  var path = "<%= create_album_user_musics_path(current_user) %>";
  var button = $('#divinputfile');
  var ajax_upload = new AjaxUpload(button, {
    action: path,
    name: 'music_album_attach',
    autoSubmit: false,
    onChange: function(file, extension){
      $('#fakefilepc').val(file);
    },
    onSubmit: function(file, ext){
      // Allow only images. You should add security check on the server-side.
      if (file == "" || (ext && /^(jpg|JPG|png|jpeg|gif)$/.test(ext))){
        // If you want to allow uploading only 1 file at time,
        // you can disable upload button

        this.setData({
          'authenticity_token': $('[name="authenticity_token"]').val(),
          'album_name':$('#album_name').val()
        });
        this.disable();
      } else {
        // extension is not allowed
        $("#error_type").dialog({
          modal: true,
          buttons: {
            Ok: function() {
              $(this).dialog('close');
            }
          }
        });
        // cancel upload
        return false;
      }
    },
    onComplete: function(file, response){
      // enable upload button
      this.enable();

      // update form
      $('#create_a_album').html(response);
    }
  });
  
  function create_album(){
    if ($("#album_name").val() == ""){
      $("#dialog-message").dialog({
        modal: true,
        buttons: {
          Ok: function() {
            $(this).dialog('close');
          }
        }
      });
    }else{
      ajax_upload.submit();
    }
  }
</script>