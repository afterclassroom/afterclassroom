<% content_for :you_are_here do -%>
  You are here: <a href="/">Home</a><%= link_to "Sign Up", "", :class => "abLink-detail" %>
<% end -%>

<!--Content-->
<div class="contDetL">
  <div class="contDetLin">
    <div class="AsDTop">
      <h1 class="titleH1">Sign Up</h1>
    </div>
    <div class="signUpCont">
      <%= display_flash_messages_with_raw %>
      <%= form_for :user, :url => users_path, :html => {:id => "form_signup", :name => "form_signup"} do |f| -%>
        <div class="signNode">*(asterisk) is required.</div>
        <div class="signinItem">
          <div class="signinTit">First Name*:</div>
          <div class="signinInp"><%= text_field_tag :first_name, session[:first_name],  :class => "required" %></div>
        </div>
        <div class="signinItem">
          <div class="signinTit">Last Name*:</div>
          <div class="signinInp"><%= text_field_tag :last_name, session[:last_name], :class => "required" %></div>
        </div>
        <div class="signinItem">
          <div class="signinTit">Email*:</div>
          <div class="signinInp"><%= f.text_field :email, :class => "required email" %></div>
        </div>
        <div class="signinItem">
          <div class="signinTit">New Password*:</div>
          <div class="signinInp"><%= f.password_field :password, :class => "required password" %></div>
        </div>
        <div class="signinItem">
          <div class="signinTit">Confirm*:</div>
          <div class="signinInp"><%= f.password_field :password_confirmation, :class => "required password" %></div>
        </div>
        <div class="popup2" id="select_school">
          <%= render :partial => "select_school" %>
        </div>
        <div class="signincCheck">
          <div><%= f.check_box :allow_search_by_email %></div>
          <div class="signincCheckTxt">Let others find my post on Afterclassroom if they have my email address.</div>
        </div>
        <div class="btmCreAc"><a href="javascript:;" onclick="submit();"><%= submit_tag 'Create my account' %></a></div>
        <div class="signincCheck">
          By clicking "Create my account", you agree to Afterclassroom <%= link_to 'Terms of use', :controller => 'statics', :action => 'terms' %> and <%= link_to 'Privacy Policy', :controller => 'statics', :action => 'privacy' %>.
        </div>
      <% end -%>
    </div>
  </div>
</div>

<div class="contMainR">
  <%= render :partial => "welcome_back" %>
  <%= render :partial => "ads/show_vertical_ads" %>
</div>
<!--Content-->

<script type="text/javascript">
  function submit(){
    var result = $("#form_signup").validate({
      rules: {
        user_password_confirmation: {
          equalTo: "#user_password"
        }
      },
      messages: {
        user_password_confirmation: {
          equalTo: "Please enter the same password as above"
        }
      }
    });
    if (result) {
      $("#form_signup").submit();
    }
  }

  $(document).ready(load_menus);
  function update_form(type_select, id){
    $.ajax({
      url: '/users_select_school/update_form_signup',
      type: 'GET',
      cache: false,
      dataType: 'html',
      data: ({
        type : type_select,
        id : id
      }),
      success: function(data){
        $('#select_school').html(data);
        load_menus();
      }
    });
  }

  function select_country(){
    update_form("country", $('#country').val());
  }

  function select_state(){
    update_form("state", $('#state').val());
  }

  function select_city(){
    update_form("city", $('#city').val());
  }

  function load_menus (){
    $("#country").mcDropdown("#country_menu", {
      width: 230,
      valueAttr: "rel_country",
      select: select_country
    });
    $("#state").mcDropdown("#state_menu", {
      width: 230,
      valueAttr: "rel_state",
      select: select_state
    });
    $("#city").mcDropdown("#city_menu", {
      width: 230,
      valueAttr: "rel_city",
      select: select_city
    });
    $("#school").mcDropdown("#school_menu", {
      width: 230,
      valueAttr: "rel_school"
    });
  }
</script>
